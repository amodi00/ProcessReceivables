/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/Dialog","sap/m/Label","sap/m/MessageToast","sap/m/Text","sap/m/TextArea","sap/m/ButtonType","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageBox","fin/ar/process/receivables/ext/formatter/formatter","fin/ar/process/receivables/ext/utils/ModelGenerator","fin/ar/process/receivables/ext/utils/DialogHandler","fin/ar/process/receivables/ext/utils/FunctionCallExecutor","fin/ar/process/receivables/ext/utils/InputValidator","s4/cfnd/sit/reuse/lists/SituationListIndicationSupport","sap/viz/ui5/format/ChartFormatter"],function(L,B,D,a,M,T,b,c,P,J,F,d,f,g,h,j,I,S,C){"use strict";var n=false;var t={"CollectionsInvoice::responsiveTable":{actions:["ActionCreateResubmissionForInvoice","ActionCreatePromiseToPayForInvoice","ActionCreateDisputeCaseForInvoice","ActionCreateNoteForInvoice","ActionIncludeInvoiceInCorrespondence"],hasDraft:false,nullable:false},"CollectionsInvoiceCompanyCode::responsiveTable":{actions:["ActionCreateNoteForInvoiceCompanyCode"],hasDraft:false,nullable:false},"DisputeCasesCollectionSegment::responsiveTable":{actions:["btnCreateDispute"],hasDraft:true,nullable:false},"PromiseToPayCollectionSegment::responsiveTable":{actions:["ActionWithdrawPromiseToPay"],hasDraft:true,nullable:false},"CollectionsResubmission::responsiveTable":{actions:["ActionCompleteResubmission"],hasDraft:true,nullable:false},"CollectionsContacts::responsiveTable":{actions:["ActionDeleteCustomerContact","ActionSetAsDefaultContact"],hasDraft:true,nullable:false},"CollectionAccountNotes--CollsAcctNoteList":{actions:[],hasDraft:false,nullable:true},"CollectionsHeadOfficeBranch::responsiveTable":{actions:[],hasDraft:false,nullable:true}};var N={"manage":{"CollectionsCustomerContact":"CollectionsCustomerContact-manage","DisputeCase":"DisputeCase-manage","PromiseToPay":"PromiseToPay-manage","CollectionsResubmission":"CollectionsResubmission-manage"},"create":{"CollectionsResubmission":"CollectionsResubmission-create","CollectionsContactPerson":"CollectionsContactPerson-create"},"display":{"HeadOfficeReceivable":"HeadOfficeReceivable-display"}};var s=[{target:{"semanticObject":"CollectionsResubmission","action":"manage"}},{target:{"semanticObject":"PromiseToPay","action":"manage"}},{target:{"semanticObject":"CollectionsResubmission","action":"create"}},{target:{"semanticObject":"CollectionsContactPerson","action":"manage"}},{target:{"semanticObject":"CollectionsContactPerson","action":"create"}},{target:{"semanticObject":"DisputeCase","action":"manage"}},{target:{"semanticObject":"CollectionsCustomerContact","action":"manage"}},{target:{"semanticObject":"HeadOfficeReceivable","action":"display"}}];return sap.ui.controller("fin.ar.process.receivables.ext.controller.ObjectPageExt",{_formatter:f,_bErrorMessageBoxOpend:false,_oDialogs:{changeStickyNoteDlg:null,createInvoiceNoteDlg:null,createInvoiceDisputeCaseDlg:null,draftDlg:null,footerMessageDlg:null,postingNoteListDlg:null,LatePaymentListDialog:null,contactInfoDlg:null,updateInvoiceDisputeCaseDlg:null,dueDateGridChartDlg:null,paymentTrendChartDlg:null,createContactPersonDlg:null,relatedDisputeCaseListDlg:null},onInit:function(){var e=this.getView().byId("CollectionsInvoice::Table");if(e){e.setIgnoredFields("BillingDocument");};this._attachEventToEachTable();this._attachEventToMicroChart();this.extensionAPI.attachPageDataLoaded(this._afterPageDataLoaded.bind(this));S.mixIntoListReportAdvanced(this,[{tableId:"fin.ar.process.receivables::sap.suite.ui.generic.template.ObjectPage.view.Details::CollectionsAccount--CollectionsInvoice::Table",anchorKeyField:"CollectionsInvoiceUniqueID",columnKey:"AccountingDocument"}]);var o=sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){var k=i.isNavigationSupported([{target:{semanticObject:"DisputeCase",action:"manage"}}],this).done(function(r){if(r.length>0){n=r[0].supported;}});});},adaptNavigationParameterExtension:function(o,O){if(o.getSelectOption("CompanyCode")&&o.getSelectOption("CompanyCode")[0].Low===""){var _=o.getSelectOption("CollectionSegment")[0].Low;this._selectionVariant=o;o.removeSelectOption("CompanyCode");for(var i=0;i<this._companies.length;i++){if(_===this._companies[i].Segment){o.addSelectOption("CompanyCode","I","EQ",this._companies[i].Company,"");}}}},onBeforeRebindTableExtension:function(e){this.addSituationInfoToListReport(e);},onInitialise:function(){var _=Object.keys(t);jQuery.each(_,function(i,k){if(!t[k].nullable){this._addCustomDataEachColumns(this.getView().byId(k));}}.bind(this));},onUpdateFinished:function(e){var o=e.getSource();var _="";var i=this.getView().getBindingContext();var k="fin.ar.process.receivables::sap.suite.ui.generic.template.ObjectPage.view.Details::CollectionsAccount--CollectionsInvoice::responsiveTable";if(o.getId()===k&&o.getItems().length>0){o.getItems().forEach(function(p){var r=p.getBindingContext().getProperty("ReferenceDocumentLogicalSystem");var H=p.getCells().find(function(E){return E.getId().indexOf("HBOX")!==-1;});if(H){var q=H.getItems().find(function(O){return O.getId().indexOf("BillingDocumentLink")!==-1;});if(r!==''){q.setEnabled(false);}else{q.setEnabled(true);}}});}if(o.getId().indexOf("CollsAcctNoteList")!==-1){_=o.getId().split("--")[1]+"--"+o.getId().split("--")[2];}else{_=o.getId().split("--")[1];}var l=t[_];if(l.actions&&l.actions.length>0){jQuery.each(l.actions,function(p,q){if(_==="CollectionsInvoice::responsiveTable"){if(this.getView().byId(_).getSelectedItems().length>0){jQuery.each(l.actions,function(p,q){this._setActionButton.call(this,q,true);}.bind(this));}else{jQuery.each(l.actions,function(p,q){this._setActionButton.call(this,q,false);}.bind(this));}}else{this._setActionButton.call(this,q,false);}}.bind(this));if(_==="CollectionsInvoice::responsiveTable"&&i&&i.getProperty("UICT_PromiseToPay")){this.getView().byId(l.actions[1]).setVisible(false);}else if(_==="CollectionsInvoice::responsiveTable"&&i&&!i.getProperty("UICT_PromiseToPay")){this.getView().byId(l.actions[1]).setVisible(true);}if(_==="CollectionsInvoice::responsiveTable"&&i&&i.getProperty("UICT_DisputeCaseCollsSegment")){this.getView().byId(l.actions[2]).setVisible(false);}else if(_==="CollectionsInvoice::responsiveTable"&&i&&!i.getProperty("UICT_DisputeCaseCollsSegment")){this.getView().byId(l.actions[2]).setVisible(true);}if(_==="DisputeCasesCollectionSegment::responsiveTable"&&n===false){this.getView().byId(l.actions[0]).setVisible(false);}else if(_==="DisputeCasesCollectionSegment::responsiveTable"&&n===true){this.getView().byId(l.actions[0]).setVisible(true);this.getView().byId(l.actions[0]).setEnabled(true);}}if(l.hasDraft){var m=o.getItems();jQuery.each(m,function(p,q){var r=q.getBindingContext().getProperty("HasActiveEntity");if(!r){q.setHighlight("Information");}});}if(_==="CollectionAccountNotes--CollsAcctNoteList"){this._addActionsToNoteItem(o);this._addHighLightToNoteItem(o);}},onClickActionDisplayHeadOfficeReceivable:function(e){var o=this.extensionAPI.getNavigationController();var i=e.getSource().getBindingContext().getProperty("CustomerHeadOffice");var k=e.getSource().getBindingContext().getProperty("CollectionSegment");var p={preferredMode:"display",Customer:i,CollectionSegment:k,IsActiveEntity:true};o.navigateExternal(N.display.HeadOfficeReceivable,p);},onListNavigationExtension:function(e){var o=this.extensionAPI.getNavigationController();if(e.getSource().getId().indexOf("DisputeCasesCollectionSegment")!==-1){var p={DraftUUID:e.getSource().getBindingContext().getProperty("DraftUUID"),CaseID:e.getSource().getBindingContext().getProperty("CaseID"),IsActiveEntity:e.getSource().getBindingContext().getProperty("IsActiveEntity"),DisputeCaseUUID:e.getSource().getBindingContext().getProperty("DisputeCaseUUID")};o.navigateExternal("DisputeCase-manage",p);return true;}else if(e.getSource().getId().indexOf("PromiseToPayCollectionSegment")!==-1){p={DraftUUID:e.getSource().getBindingContext().getProperty("DraftUUID"),CaseID:e.getSource().getBindingContext().getProperty("CaseID"),IsActiveEntity:e.getSource().getBindingContext().getProperty("IsActiveEntity"),PromiseToPayUUID:e.getSource().getBindingContext().getProperty("PromiseToPayUUID")};o.navigateExternal("PromiseToPay-manage",p);return true;}else{return false;}},_initPageElementStatus:function(e){var _=this.getView().getBindingContext();var i=this.getView().byId("action::ActionFinishCustomerContact");var k=this.getView().byId("objectPage-OPHeaderContent");if(this._oMessageStrip&&k.getContent().length>1){var l=k.getContent()[k.getContent().length-1];k.removeContent(l);this._oMessageStrip.destroy();this._oMessageStrip=undefined;}if(_&&_.getProperty("UICT_LastCustomerContactDate")){i.setText(this.getView().getModel("i18n").getProperty("FinishCustomerContact"));i.setTooltip(this.getView().getModel("i18n").getProperty("CustomerContactIsAvailable"));if(k&&k.getId().indexOf("CollectionsAccount")!==-1){this._oMessageStrip=new sap.m.MessageStrip(this.getView().createId("messageString"),{text:"",type:"Warning",showIcon:true,link:new sap.m.Link({text:this.getView().getModel("i18n").getProperty("LinkFinishCustomerContact"),press:this.onClickActionFinishCustomerContact.bind(this)})});k.addContent(this._oMessageStrip);}}else{i.setText(this.getView().getModel("i18n").getProperty("CreateCustomerContact"));i.setTooltip("");}var m=this.getView().byId("action::ActionDisplayHeadOfficeReceivable");if(_&&_.getProperty("UICT_HeadOfficeReceivables")===true){m.setVisible(true);}else if(_&&_.getProperty("UICT_HeadOfficeReceivables")===false){m.setVisible(false);}},_addCustomDataEachColumns:function(e){if(e){var _=e.getColumns();jQuery.each(_,function(i,k){var l=k.getCustomData();if(l.length>0){var m=l[0].getValue();if(m&&typeof m==="string"){m=JSON.parse(m);m.nullable=false;m=JSON.stringify(m);}else if(m&&typeof m==="object"){m.nullable=false;}l[0].setValue(m);}});}},_addActionsToNoteItem:function(o){var _=sap.ushell.Container.getService("UserInfo").getId();var e=o.getItems();var i="";if(e.length>0){i=e[0].getBindingContext().getProperty();}if(_===i.CreatedByUser&&e.length>0&&e[0].getActions().length===0&&i.MigrationStatus==="0"){e[0].addAction(new sap.m.FeedListItemAction({icon:"sap-icon://edit",text:this.getView().getModel("i18n").getProperty("BtnEdit"),key:"Edit",press:this.onUpdateAccountNote.bind(this,e[0])}));if(e[1]){e[1].removeAllActions();}}},_addHighLightToNoteItem:function(o){var _=o.getItems();jQuery.each(_,function(i,e){var k=e.getBindingContext().getProperty("NoteIconURL");switch(k){case"sap-icon://quality-issue":e.setHighlight("Warning");break;default:e.setHighlight("None");break;}});},onSelectItem:function(e){var _=e.getSource().getId().split("--")[1];var k=false;if(_==="PromiseToPayCollectionSegment::responsiveTable"||_==="CollectionsResubmission::responsiveTable"||_==="CollectionsContacts::responsiveTable"){var l=e.getSource().getSelectedItems();for(var i=0;i<l.length;i++){if(!l[i].getBindingContext().getProperty("IsActiveEntity")){k=true;break;}}if(_==="CollectionsResubmission::responsiveTable"){if(l.length===1&&l[0].getBindingContext().getProperty("ResubmissionStatus")=="1"){k=true;}}}if(t[_].actions.length>0&&e.getSource().getSelectedItems().length>0&&!k){jQuery.each(t[_].actions,function(m,o){this._setActionButton.call(this,o,true);}.bind(this));}else if(t[_].actions.length>0&&e.getSource().getSelectedItems().length>0&&k){jQuery.each(t[_].actions,function(m,o){this._setActionButton.call(this,o,false);}.bind(this));}else if(t[_].actions.length>0&&e.getSource().getSelectedItems().length===0){jQuery.each(t[_].actions,function(m,o){this._setActionButton.call(this,o,false);}.bind(this));}},_attachEventToEachTable:function(){var _=Object.keys(t);jQuery.each(_,function(i,k){var e=this.getView().byId(k);if(e){e.attachUpdateFinished(this.onUpdateFinished.bind(this));if(k!=="CollectionAccountNotes--CollsAcctNoteList"){e.getParent().attachBeforeExport(this._changeExportExcelTemplate);e.getParent().attachInitialise(this.onInitialise.bind(this));}if(k!=="DisputeCasesCollectionSegment::responsiveTable"){e.attachSelect(this.onSelectItem.bind(this));}}}.bind(this));},_attachEventToMicroChart:function(){var _=this.getView().byId("header::headerEditable::DueDateGrid::SmartMicroChart");var e=this.getView().byId("header::headerEditable::PaymentTrend::SmartMicroChart");if(_){_.attachBrowserEvent("click",this._openDueDateGridChart.bind(this));_.attachBrowserEvent("mouseover",function(E){E.currentTarget.style.cursor="pointer";});}if(e){e.attachBrowserEvent("click",this._openPaymentTrandChart.bind(this));e.attachBrowserEvent("mouseover",function(E){E.currentTarget.style.cursor="pointer";});}},_openDueDateGridChart:function(e){var _=this.getView().byId("header::headerEditable::DueDateGrid::SmartMicroChart");var i=_.getBindingContext().getPath()+"/to_CollectionsDueDateGrid";if(this._oDialogs.dueDateGridChartDlg){return;}h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.DueDateGridPopover","dueDateGridDlg").then(function(o){this._oDialogs.dueDateGridChartDlg=o;this._oDialogs.dueDateGridChartDlg.attachAfterClose(this.onCloseDueDateGridDlg.bind(this));return j.getChartData(this,{url:i});}.bind(this)).then(function(r){if(r.results.length===0){return;}var k=false;var l=g.generateDataModelForDueDateGridChart(r);var m=h.getDialogElement(this,"dueDateGridDlg","DueDateGridChart");this._initDueDateGridChartFormatter(l.MaxAmount,l.ChartCurrency);this._oDialogs.dueDateGridChartDlg.setModel(new J(l),"json");this._oDialogs.dueDateGridChartDlg.setModel(this.getView().getModel("i18n"),"i18n");m.attachRenderComplete(function(){if(!k){h.updateDueDateGridPlot(m);k=true;}},this);this._oDialogs.dueDateGridChartDlg.openBy(_);}.bind(this));},_initDueDateGridChartFormatter:function(e,i){var o=sap.viz.ui5.format.ChartFormatter.getInstance();o.registerCustomFormatter("DueDateGridChartFormatAxisAmount",function(v){var r;if(e<100000){r=this._formatter.formatChartYValuesLong(v,i);}else{r=this._formatter.formatChartYValuesShort(v,i);}return r;}.bind(this));o.registerCustomFormatter("FormatAmountStandard",function(v){var r=this._formatter.formatAmount(v);return r;}.bind(this));sap.viz.ui5.api.env.Format.numericFormatter(o);},onCloseDueDateGridDlg:function(){this._closeDlg("dueDateGridChartDlg");},_openPaymentTrandChart:function(){var _=this.getView().byId("header::headerEditable::PaymentTrend::SmartMicroChart");var e=_.getBindingContext().getPath()+"/to_CollectionsPaymentTrend";if(this._oDialogs.paymentTrendChartDlg){return;}h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.PaymentTrendPopover","paymentTrendDlg").then(function(o){this._oDialogs.paymentTrendChartDlg=o;this._oDialogs.paymentTrendChartDlg.attachAfterClose(this.onClosePaymentTrendChart.bind(this));return j.getChartData(this,{url:e});}.bind(this)).then(function(r){if(r.results.length===0){return;}var i=g.generateDataModelForPaymentTrendChart(this.getView().getModel("i18n").getProperty("WeightedDaysOverdue"),r);this._initPaymentTrendFormatter();this._oDialogs.paymentTrendChartDlg.setModel(new J(i),"json");this._oDialogs.paymentTrendChartDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.paymentTrendChartDlg.openBy(_);}.bind(this));},_initPaymentTrendFormatter:function(){var _=sap.viz.ui5.format.ChartFormatter.getInstance();_.registerCustomFormatter("PaymentTrendChartAxisAmount",function(v){return this._formatter.formatPaymentTrendYValue(v);}.bind(this));_.registerCustomFormatter("FormatWeightedDueDays",function(v){return this._formatter.formatWeightedDueDays(v);}.bind(this));sap.viz.ui5.api.env.Format.numericFormatter(_);},onClosePaymentTrendChart:function(){this._closeDlg("paymentTrendChartDlg");},_changeExportExcelTemplate:function(e){var _=e.getParameter("exportSettings").workbook.columns;jQuery.each(_,function(k,l){if(l.property==="ResubmissionDueDate"){l.type="Date";}if(l.property[0]==="NetDueDate"){l.property="NetDueDate";l.template=null;l.type="Date";}if(Object.prototype.toString.call(l.property)==="[object Array]"){var m="";for(var i=0;i<l.property.length;i++){m=m+"{"+i+"}"+" ";}l.template=m;}});},onClickActionIncludeInvoiceInCorrespondence:function(){h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.IncludeInvoiceInCorrespondence","includeInvoiceInCorrespondenceDlg").then(function(o){this._oDialogs.includeInvoiceInCorrespondenceDlg=o;this._oDialogs.includeInvoiceInCorrespondenceDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.includeInvoiceInCorrespondenceDlg.open();}.bind(this));},onIncludeInvoiceInCorrespondenceConfirm:function(e){var _=h.getDialogElement(this,"includeInvoiceInCorrespondenceDlg","checkBoxCreateBillingDocument").getSelected();var i=h.getDialogElement(this,"includeInvoiceInCorrespondenceDlg","checkBoxIncludeInCorrespondence").getSelected();this._closeDlg("includeInvoiceInCorrespondenceDlg");j.executeIncludeInvoiceInCorrespondence(this,_,i,function(r){var k=this;var p=this.getView().getBindingContext().getPath();this.getView().getModel().read(p,{success:function(){k._initPageElementStatus();}});}.bind(this),function(k){});},onIncludeInvoiceInCorrespondenceCancel:function(){this._closeDlg("includeInvoiceInCorrespondenceDlg");},onClickCreateDisputeCase:function(e){var _=Object.keys(t);var o=this.getView().byId(_[0]);var i=o.getSelectedItems();var k={};var l={};var A=[];jQuery.each(i,function(q,r){var u=r.getBindingContext().getProperty("CompanyCode");var v=r.getBindingContext().getProperty("CompanyCodeName");var w=r.getBindingContext().getProperty("TransactionCurrency");if(!k.hasOwnProperty(u)){k[u]=v;}if(!l.hasOwnProperty(w)){l[w]=1;A.push(w);}});var m=g.generateDataModelForCreateDispute(k,l);if(!this._oCreateDisputeCasesDlg&&(m.CompanyCodeVisible||m.CurrencyVisible)){h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CollectionInvoiceDialog.CreateInvoiceDisputeCaseDialog","createInvoiceDisputeCaseDlg").then(function(q){this._oDialogs.createInvoiceDisputeCaseDlg=q;this._oDialogs.createInvoiceDisputeCaseDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.createInvoiceDisputeCaseDlg.setModel(new J(m));this._oDialogs.createInvoiceDisputeCaseDlg.open();}.bind(this));}else{if(A.length===1){var p=A[0];}this.onClickActionCreateDisputeCaseForInvoice(e,p);}},onClickCreateCustomerDispute:function(e){var _=this.getView().getModel();var i=this.getView().getBindingContext().getProperty("CollectionSegment");var k=this.getView().getBindingContext().getProperty("Customer");j.getCompaniesPromise(_,{Segment:i,Customer:k}).then(function(r){var l=g.generateCreateDisputeCaseDlgModel(r.results);h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CreateDisputeDialog","CreateDisputeCaseDialog").then(function(p){this._oDialogs.createDisputeDlg=p;this._oDialogs.createDisputeDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.createDisputeDlg.setModel(new J(l),"localJson");this._oDialogs.createDisputeDlg.open();var m=h.getDialogElement(this,"CreateDisputeCaseDialog","inputCompany");m.fireSelectionChange();}.bind(this));}.bind(this));},onCreateDisputeCaseDlgClose:function(){this._closeDlg("createInvoiceDisputeCaseDlg");},onCreateDisputeCaseDlgConfirm:function(e){this.onClickActionCreateDisputeCaseForInvoice(e);},onCreateCustomerDisputeCancel:function(){this._closeDlg("createDisputeDlg");},onClickActionChangeStickyNote:function(e){var _=g.generateDataModelForChangeStickyNote(this,e.getSource().getBindingContext());if(!this._oDialogs.changeStickyNoteDlg){h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CollectionInvoiceDialog.ChangeStickyNoteDialog","changeStickyNoteDlg").then(function(o){this._oDialogs.changeStickyNoteDlg=o;this._oDialogs.changeStickyNoteDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.changeStickyNoteDlg.setModel(new J(_));this._attachStickyNoteValidation();this._oDialogs.changeStickyNoteDlg.open();}.bind(this));}},_attachStickyNoteValidation:function(){var _=this._byDialogId("changeStickyNoteDlg","changeStickyNoteTextArea");_.attachValidationError(function(){_.setValueState("Error");});_.attachValidationSuccess(function(){_.setValueState("None");});},_closeDlg:function(e){if(this._oDialogs[e]&&this._oDialogs[e].Dlg){this._oDialogs[e].Dlg.destroy();}else if(this._oDialogs[e]){this._oDialogs[e].destroy();}this._oDialogs[e]=null;},onChangeStickyNoteCancel:function(){this._closeDlg("changeStickyNoteDlg");},onChangeStickyNoteConfirm:function(){var _=this._oDialogs.changeStickyNoteDlg.getModel().getProperty("/noteTextState");if(_==="Error"){return;}j.executeChangeSticky(this).then(function(r){var e=this.getView().byId("header::headerEditable::StickyNote::PlainTextVBox");var i=this.getView().byId("action::ActionChangeStickyNote");i.setEnabled(false);e.setBusy(true);if(e){var k=this.getView().getModel();var l=e.getBindingContext().getPath();k.read(l,{success:function(R){if(R&&R.NoteText&&R.NoteText!==""){i.setText(this.getView().getModel("i18n").getProperty("ActionChangeStickyNote"));}else{i.setText(this.getView().getModel("i18n").getProperty("ActionCreateStickyNote"));}e.setBusy(false);i.setEnabled(true);}.bind(this),error:function(){e.setBusy(false);i.setEnabled(true);}});}this._closeDlg("changeStickyNoteDlg");}.bind(this));},onClickActionCreateNoteForInvoice:function(e){var _=g.generateDataModelForCreateInvoiceNote();var i=e.getSource();var k=i.getParent().getParent();var l=k.getId().match(/--.+::responsiveTable/)[0].replace("--","");if(!this._oDialogs.createInvoiceNoteDlg){this._oDialogs.createInvoiceNoteDlg={};h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CollectionInvoiceDialog.CreateInvoiceNoteDialog","createInvoiceNoteDlg").then(function(o){this._oDialogs.createInvoiceNoteDlg.Dlg=o;this._oDialogs.createInvoiceNoteDlg.eventFrom=l;this._oDialogs.createInvoiceNoteDlg.Dlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.createInvoiceNoteDlg.Dlg.setModel(new J(_));this._oDialogs.createInvoiceNoteDlg.Dlg.open();}.bind(this));}},onCreateInvoiceNoteCancel:function(){this._closeDlg("createInvoiceNoteDlg");},onCreateInvoiceNoteConfirm:function(e){var _=this._oDialogs.createInvoiceNoteDlg.Dlg.getModel().getProperty("/invoiceNoteText");this._closeDlg("createInvoiceNoteDlg");j.executeCreateInvoiceNote(_,this,function(r){var i=this.getView().getId().replace("CollectionsAccount","CollectionsInvoice--CollectionsInvoiceNote--CollsInvNoteList");sap.ui.getCore().byId(i).getBinding("items").refresh();}.bind(this),function(i){});},onBeforeSemanticObjPopoverOpen:function(e){var _=e.getParameters();var i=e.getSource().getBindingContext();var k=_.semanticAttributes;var l=_.semanticObject;k.PaidAmount=undefined;k.CreditedAmount=undefined;if(k&&l==="DisputeCase"){k.CaseID=k.DisputeCase;}else if(k&&l==="PromiseToPay"){k.CaseID=k.PromiseToPay;k.Customer=i.getProperty("Customer");}else if(k&&l==="CollectionsResubmission"){k.ResubmissionUUID=i.getProperty("ResubmissionUUID");k.ResubmissionDueDate=i.getProperty("ResubmissionDueDate");k.BusinessPartner=e.getSource().getBindingContext().getProperty("BusinessPartner");k.CollectionSegment=e.getSource().getBindingContext().getProperty("CollectionSegment");}else if(k&&l==="AccountingDocument"){if(k["sap-system"]===""){delete k["sap-system"];}}else if(k&&l==="Customer"){k.CollectionSegment=this.getView().getBindingContext().getProperty("CollectionSegment");if(k.CollectionSegment===null||k.CollectionSegment===""){k.CompanyCode=this.getView().getBindingContext().getProperty("CompanyCode");}else{}if(_.id.search("headQuarterLink")===-1){k.Customer=i.getProperty("BranchAccount");}else{k.Customer=i.getProperty("HeadOffice");}delete k.BusinessPartner;delete k.HeadOfficeName;delete k.BranchName;}},onCustomerTargetsObtained:function(e){var _=this.getView().getBindingContext().getProperty("CompanyCode");if(_===""){jQuery.each(e.getParameters().actions,function(i){var k=e.getParameters().actions[i].getProperty("href").split("&sap-app-origin-hint")[0];k=k.replace("BusinessPartner=","");if(k.search("Receivables")===-1){k=k.replace("CompanyCode=","");}e.getParameters().actions[i].setProperty("href",k);});}},onClickActionCreateResubmission:function(e){var o=this.extensionAPI.getNavigationController();var p={preferredMode:"create",ResubmissionUUID:"00000000-0000-0000-0000-000000000000",BusinessPartner:e.getSource().getBindingContext().getProperty("BusinessPartner"),CollectionSegment:e.getSource().getBindingContext().getProperty("CollectionSegment")};j.executeAuthCheckBeforeNav(this,"/CheckAuthorization",{CollectionSegment:e.getSource().getBindingContext().getProperty("CollectionSegment")}).then(function(r){if(r&&!r[0].response.data.CheckAuthorization.Noauthority){o.navigateExternal(N.create.CollectionsResubmission,p);}else{var _=this.getView().getModel("i18n");var i={title:_.getProperty("ErrorMsgDialogTitle"),type:"Message",state:"Error",content:_.getProperty("ErrorMsgDialogContent"),btnText:_.getProperty("ErrorMsgDialogOK")};h.openMessageDialog(i);}}.bind(this));},onClickActionCompleteResubmission:function(e){j.executeCompleteResubmission(this,function(r){this._refreshTableContent("CollectionsResubmission::responsiveTable",{});}.bind(this),function(i){});},onClickActionCreateCustomerContact:function(e){if(!this._oDialogs.createContactPersonDlg){this._oDialogs.createContactPersonDlg={};h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CreateContactPersonDialog","createContactPersonDlg").then(function(o){this._oDialogs.createContactPersonDlg=o;this.getView().addDependent(this._oDialogs.createContactPersonDlg);this._oDialogs.createContactPersonDlg.open();}.bind(this));}},onCreateContactPersonHelp:function(){d.information(this.getView().getModel("i18n").getProperty("ChooseContactPersonHelp"));},onCreateContactPersonCancel:function(e){var _=e.getSource().getBindingContext().getProperty("BusinessPartner");var i="/CollectionsContactForCreate('"+_+"')";this.getView().getModel().resetChanges([i]);this._closeDlg("createContactPersonDlg");},onCreateContactPersonDialogConfirm:function(e){var i=h.getDialogElement(this,"createContactPersonDlg","businessPartnerPerson").getValue();var v=h.getDialogElement(this,"createContactPersonDlg","businessPartnerPerson").getValueState();if(v!=="Error"){var _=e.getSource().getBindingContext().getProperty("BusinessPartner");var k="/CollectionsContactForCreate('"+_+"')";this.getView().getModel().resetChanges([k]);var o=this.extensionAPI.getNavigationController();var p={preferredMode:"create",RelationshipNumber:"",BusinessPartnerCompany:e.getSource().getBindingContext().getProperty("BusinessPartner"),BusinessPartnerPerson:i,CollectionSegment:e.getSource().getBindingContext().getProperty("CollectionSegment")};var l={Businesspartner:e.getSource().getBindingContext().getProperty("BusinessPartner"),Contactperson:i};j.executeAuthCheckBeforeNav(this,"/CheckAuthForCustomerContact",l).then(function(r){if(r&&!r[0].response.data.CheckAuthForCustomerContact.Noauthority){o.navigateExternal(N.create.CollectionsContactPerson,p);}else{var m=this.getView().getModel("i18n");var q={title:m.getProperty("ErrorMsgDialogTitle"),type:"Message",state:"Error",content:m.getProperty("ErrorMsgDialogContent"),btnText:m.getProperty("ErrorMsgDialogOK")};h.openMessageDialog(q);}}.bind(this));this._closeDlg("createContactPersonDlg");}},onClickActionShowRelatedPromisesToPay:function(e){var o=this.extensionAPI.getNavigationController();var E=e.getSource();var i=E.getParent().getParent().getSelectedItems();var p={preferredMode:"display",Prms2PToInvoiceGroupRefUUID:i[0].getBindingContext().getProperty("Prms2PToInvoiceGroupRefUUID")};o.navigateExternal(N.manage.PromiseToPay,p);},onClickActionSetAsDefaultContact:function(e){var _=this.getView().getModel();var i=this.getView().byId("fin.ar.process.receivables::sap.suite.ui.generic.template.ObjectPage.view.Details::CollectionsAccount--header::headerEditable::GeneralData::Form");var k=i.getBindingContext();var l=k.getPath();i.setBusy(true);j.executeSetDefaultContract(this).then(function(){this._refreshTableContent("CollectionsContacts::responsiveTable",{});var m=this.getView().byId("CollectionsContacts::responsiveTable");m.removeSelections();_.read(l,{urlParameters:{"$expand":"to_CollectionsMainContact"},success:function(){i.setBusy(false);},error:function(){i.setBusy(false);}});}.bind(this));},onClickActionDeleteCustomerContact:function(E){var o=E.getSource();var i=o.getParent().getParent();var k=i.getSelectedItem();var l=this.getView().getModel("i18n").getResourceBundle();var m=l.getText("DeleteCustomerContactConfirmation",k.getBindingContext().getProperty("ContactPersonName"));d.warning(m,{title:l.getText("ConfirmDeleteCustomerContactTitle"),actions:[d.Action.YES,d.Action.NO],emphasizedAction:d.Action.YES,onClose:function(A){if(A==="YES"){var p={"RelationshipNumber":k.getBindingContext().getProperty("RelationshipNumber"),"BusinessPartnerCompany":k.getBindingContext().getProperty("BusinessPartnerCompany"),"BusinessPartnerPerson":k.getBindingContext().getProperty("BusinessPartnerPerson"),"CollectionSegment":k.getBindingContext().getProperty("CollectionSegment"),"DraftUUID":"00000000-0000-0000-0000-000000000000","IsActiveEntity":true};i.setBusy(true);j.deleteCustomerContact(this,p).then(function(r){i.setBusy(false);this._refreshTableContent("CollectionsContacts::responsiveTable",{});var _=r.headers["sap-message"];var q={"message":"","severity":"success"};try{q=JSON.parse(_);}catch(e){}if(q.severity==="success"){sap.m.MessageToast.show(q.message);}else{sap.m.MessageBox.Error(q.message);}}.bind(this)).catch(function(e){i.setBusy(false);try{var _=JSON.parse(e.responseText);sap.m.MessageBox.Error(_.message);}catch(e){}});}}.bind(this)});},onClickActionWithdrawPromiseToPay:function(e){j.executeRevokePromiseToPay(this).then(function(){this._refreshTableContent("PromiseToPayCollectionSegment::responsiveTable",{});}.bind(this));},onClickActionCreatePromiseToPayForInvoice:function(e){j.executeCreatePromiseToPay(this,function(r){var o=this.extensionAPI.getNavigationController();var p=r[0][0].response.data.CreatePromiseToPay.Caseuuid;var i=r[0][0].response.data.CreatePromiseToPay.Draftuuid;var k={preferredMode:"display",PromiseToPayUUID:p,DraftUUID:i,IsActiveEntity:false};o.navigateExternal(N.manage.PromiseToPay,k);}.bind(this),function(i){});},onClickActionCreateResubmissionForInvoice:function(e){j.executeCreateInvoiceResubmission(this,function(r){var o=this.extensionAPI.getNavigationController();var R=r[0][0].response.data.CreateResubmission.Caseuuid;var i=r[0][0].response.data.CreateResubmission.Draftuuid;var p={preferredMode:"display",ResubmissionUUID:R,DraftUUID:i,IsActiveEntity:false};o.navigateExternal(N.manage.CollectionsResubmission,p);}.bind(this));},onClickActionCreateDisputeCaseForInvoice:function(e,i){var _="";var k="";var l=false;var m=false;if(this._oDialogs.createInvoiceDisputeCaseDlg){l=this._oDialogs.createInvoiceDisputeCaseDlg.getModel().getProperty("/CompanyCodeVisible");m=this._oDialogs.createInvoiceDisputeCaseDlg.getModel().getProperty("/CurrencyVisible");_=h.getDialogElement(this,"createInvoiceDisputeCaseDlg","selectCompanyCode").getSelectedKey();k=h.getDialogElement(this,"createInvoiceDisputeCaseDlg","selectCurrency").getSelectedKey();}if(this._oDialogs.createInvoiceDisputeCaseDlg&&l&&_===""){this._byDialogId("createInvoiceDisputeCaseDlg","selectCompanyCode").setValueState(sap.ui.core.ValueState.Error);return;}if(this._oDialogs.createInvoiceDisputeCaseDlg&&m&&k===""){this._byDialogId("createInvoiceDisputeCaseDlg","selectCurrency").setValueState(sap.ui.core.ValueState.Error);return;}if(k){var o=k;}else{o=i;}j.executeCreateDisputeCaseForInvoices(this,{CompanyCode:_,Currency:o},function(r){var p=this.extensionAPI.getNavigationController();var q=r[0][0].response.data.CreateDisputeCase.Caseuuid;var u=r[0][0].response.data.CreateDisputeCase.Draftuuid;var v={preferredMode:"display",DisputeCaseUUID:q,DraftUUID:u,IsActiveEntity:false};p.navigateExternal(N.manage.DisputeCase,v);this._closeDlg("createInvoiceDisputeCaseDlg");}.bind(this),function(p){this._closeDlg("createInvoiceDisputeCaseDlg");}.bind(this));},onCreateCustomerDisputeConfirm:function(e){var _=this._oDialogs.createDisputeDlg.getModel("localJson");var i=_.getProperty("/SelectedCompany");var k=this.getView().getModel("i18n").getProperty("SelectACompany");if(!i||i.length===0){h.getDialogElement(this,"CreateDisputeCaseDialog","inputCompany").setValueState(sap.ui.core.ValueState.Error);h.getDialogElement(this,"CreateDisputeCaseDialog","inputCompany").setValueStateText(k);return;}this._closeDlg("createDisputeDlg");j.executeCreateCustomerDisputeCase(this,{CompanyCode:i}).then(function(r){var o=this.extensionAPI.getNavigationController();var l=r[0].response.data.DisputeCaseUUID;var m=r[0].response.data.DraftUUID;var p={preferredMode:"edit",DisputeCaseUUID:l,DraftUUID:m,IsActiveEntity:false};o.navigateExternal(N.manage.DisputeCase,p);}.bind(this));},onCompanySelectionChanged:function(e){var _=e.getSource();var i="";if(_.getSelectedItem()){i=_.getSelectedItem().getProperty("key");}var k=this._oDialogs.createDisputeDlg.getModel("localJson");k.setProperty("/SelectedCompany",i);},onClickActionFinishCustomerContact:function(e){j.executeCompleteCustomerContact(this).then(function(r){var o=this.extensionAPI.getNavigationController();var i=r[0].response.data.CompleteCustomerContact.Customercontactuuid;var k=r[0].response.data.CompleteCustomerContact.Draftuuid;var p={preferredMode:"display",CustomerContactUUID:i,DraftUUID:k,IsActiveEntity:false};o.navigateExternal(N.manage.CollectionsCustomerContact,p);}.bind(this));},onIconOfAccountNotePress:function(e){var o=this.extensionAPI.getNavigationController();var m=e.getSource().getBindingContext().getProperty("MigrationStatus");var i=e.getSource().getBindingContext().getProperty("CustomerContactUUID");var k=e.getSource().getBindingContext().getProperty("DraftUUID");var _=sap.ushell.Container.getService("UserInfo").getId();var p={preferredMode:"display",CustomerContactUUID:i,DraftUUID:k,IsActiveEntity:true};if(m==="1"){o.navigateExternal(N.manage.CollectionsCustomerContact,p);}else if(m==="3"){p.IsActiveEntity=false;if(_===e.getSource().getBindingContext().getProperty("CreatedByUser")){o.navigateExternal(N.manage.CollectionsCustomerContact,p);}else{M.show(this.getView().getModel("i18n").getProperty("NotCorrectCustomerConcatcNav"));}}else{M.show(this.getView().getModel("i18n").getProperty("NoCustomerContactNav"));}},onUserDescriptionClick:function(e){var o=e.getSource();var _=o.getBindingContext()||o.getBindingContext("NoteHistory");var i=_.getProperty();var k=g.generateDataModelForContactCard(i);h.createPopoverDialog(this,"sap.suite.ui.generic.template.fragments.ContactDetails","contactDetails").then(function(p){this._oDialogs.contactInfoDlg=p;this._oDialogs.contactInfoDlg.openBy(o._getLinkSender());this._oDialogs.contactInfoDlg.setModel(new J(k),"contact");this._oDialogs.contactInfoDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.contactInfoDlg.attachAfterClose(this.onCloseUserDescription.bind(this));}.bind(this));},onCloseUserDescription:function(e){this._closeDlg("contactInfoDlg");},onDraftClick:function(e){var o=e.getSource().getBindingContext();var i=e.getSource();if(this._oDialogs.draftDlg){this._closeDlg("draftDlg");}var _=g.generateDataModelForDraftDlg(o);h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.DraftPopover","draftInfoPopover").then(function(p){this._oDialogs.draftDlg=p;this._oDialogs.draftDlg.setModel(new J(_.adminData),"admin");this._oDialogs.draftDlg.setModel(new J(_.generalData),"general");this._oDialogs.draftDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.draftDlg.openBy(i);this._oDialogs.draftDlg.attachAfterClose(this.closeDraftAdminPopover.bind(this));}.bind(this));},closeDraftAdminPopover:function(e){this._closeDlg("draftDlg");},onPostingKeyClick:function(e){var _=e.getSource();var i=_.getBindingContext();var k="postingNoteListDialog";h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.PostingNoteList",k).then(function(p){this._oDialogs.postingNoteListDlg=p;this._oDialogs.postingNoteListDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.postingNoteListDlg.attachAfterClose(this.onPostingNoteListClose.bind(this));this._oDialogs.postingNoteListDlg.openBy(_);var l=this._byDialogId(k,"postingNoteList");l.setBusy(true);return j.getPostNote(this,{CollectionSegment:i.getProperty("CollectionSegment"),CompanyCode:i.getProperty("CompanyCode"),FiscalYear:i.getProperty("FiscalYear"),AccountingDocument:i.getProperty("AccountingDocument"),AccountingDocumentItem:i.getProperty("AccountingDocumentItem")});}.bind(this)).then(function(r){var l=g.generateDataModelForPostNoteListPopover(r);var m=this._byDialogId(k,"postingNoteList");this._oDialogs.postingNoteListDlg.setModel(new J(l),"NoteHistory");m.setBusy(false);}.bind(this));},onLatePaymentRiskClick:function(e){var _=e.getSource();var i=_.getBindingContext();var k="LatePaymentListDialog";h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.LatePaymentRisk",k).then(function(p){this._oDialogs.LatePaymentListDialog=p;this._oDialogs.LatePaymentListDialog.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.LatePaymentListDialog.openBy(_);this._oDialogs.LatePaymentListDialog.attachAfterClose(this.onLatePaymentListClose.bind(this));return j.getLatePaymentRiskFactors(this,{CollectionSegment:i.getProperty("CollectionSegment"),CompanyCode:i.getProperty("CompanyCode"),FiscalYear:i.getProperty("FiscalYear"),AccountingDocument:i.getProperty("AccountingDocument"),AccountingDocumentItem:i.getProperty("AccountingDocumentItem")});}.bind(this)).then(function(r){var l=g.generateDataModelForLatePaymentRiskPopover(r,this);var m=new J(l);this._oDialogs.LatePaymentListDialog.setModel(m,"LatePayment");}.bind(this));},onPostingNoteListClose:function(e){this._closeDlg("postingNoteListDlg");},onLatePaymentListClose:function(){this._closeDlg("LatePaymentListDialog");},onDisputeCaseClick:function(e){var _=e.getSource();var i=_.getBindingContext();var k="relatedDisputeCaseDialog";h.createPopoverDialog(this,"fin.ar.process.receivables.ext.fragments.RelatedDisputeCaseList",k).then(function(p){this.getView().addDependent(p);p.bindElement(i.getPath());this._oDialogs.relatedDisputeCaseListDlg=p;this._oDialogs.relatedDisputeCaseListDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.relatedDisputeCaseListDlg.attachAfterClose(this.onRelatedDisputeCasesClose.bind(this));this._oDialogs.relatedDisputeCaseListDlg.openBy(_);}.bind(this));},onRelatedDisputeCasesClose:function(e){this._closeDlg("relatedDisputeCaseListDlg");},onPostNote:function(e){j.executePostNote(this,e).then(function(){this._refreshTableContent("CollectionAccountNotes--CollsAcctNoteList",{});}.bind(this));},onPostInvoiceNote:function(e){j.executePostInvoiceNote(this,e).then(function(){this._refreshTableContent("CollectionsInvoiceNote--CollsInvNoteList",{});}.bind(this));},onBillingDocumentIconPress:function(e){var o=e.getSource().getBindingContext();j.executeGetBillingDocumentURL(this,o).then(function(r){var u=r[0].response.data.DetermineURLForExtLinkdObj.Url;sap.m.URLHelper.redirect(u,true);});},_getBillingDocumentWithLeadingZeroes:function(e){var i=String(e);while(i.length<10){i="0"+i;}return i;},onUpdateAccountNote:function(o){var _=this.getView().getBindingContext();var e=g.generateDataModelForUpdateInvoiceNote(_,o.getBindingContext());h.createDialogWithTextArea(this,"fin.ar.process.receivables.ext.fragments.CollectionInvoiceDialog.UpdateAccountNoteDialog","updateInvoiceDialog").then(function(i){this._oDialogs.updateInvoiceDisputeCaseDlg=i;this._oDialogs.updateInvoiceDisputeCaseDlg.setModel(this.getView().getModel("i18n"),"i18n");this._oDialogs.updateInvoiceDisputeCaseDlg.setModel(new J(e));this._oDialogs.updateInvoiceDisputeCaseDlg.open();}.bind(this));},onUpdateAccountNoteConfirm:function(e){var _=e.getSource().getParent().getModel().getData();j.executeUpdatePostNote(this,{Customer:_.Customer,CompanyCode:_.CompanyCode,CollectionSegment:_.CollectionSegment,Noteid:_.NoteId,Notetext:_.noteText}).then(function(){this._refreshTableContent("CollectionAccountNotes--CollsAcctNoteList",{});}.bind(this));this._closeDlg("updateInvoiceDisputeCaseDlg");},onUpdateAccountNoteCancel:function(){this._closeDlg("updateInvoiceDisputeCaseDlg");},_afterPageDataLoaded:function(e){var _=this.getView().getBindingContext().getPath().substring(1);var k=e.context.getModel().oData[_];if(k&&k.UICT_SegmentAuthorization&&!k.CompanyCodeIsWorkable){if(this.getView().byId("action::ActionFinishCustomerContact")){this.getView().byId("action::ActionFinishCustomerContact").setVisible(true);}}else{if(this.getView().byId("action::ActionFinishCustomerContact")){this.getView().byId("action::ActionFinishCustomerContact").setVisible(false);}}if(k&&k.UICT_CollectableAmount){if(this.getView().byId("header::headerEditable::AmountToBeCollected::SmartMicroChartTitle")){this.getView().byId("header::headerEditable::AmountToBeCollected::SmartMicroChartTitle").setVisible(false);}}else if(k&&!k.UICT_CollectableAmount){if(this.getView().byId("header::headerEditable::AmountToBeCollected::SmartMicroChartTitle")){this.getView().byId("header::headerEditable::AmountToBeCollected::SmartMicroChartTitle").setVisible(true);}}if(k&&k.CompanyCodeIsWorkable){if(this.getView().byId("action::ActionChangeStickyNote")){this.getView().byId("action::ActionChangeStickyNote").setVisible(false);}if(this.getView().byId("header::headerEditable::StickyNote::PlainTextLabel")){this.getView().byId("header::headerEditable::StickyNote::PlainTextLabel").setVisible(false);}}else if(k&&!k.CompanyCodeIsWorkable){if(this.getView().byId("action::ActionChangeStickyNote")){this.getView().byId("action::ActionChangeStickyNote").setVisible(true);}if(this.getView().byId("header::headerEditable::StickyNote::PlainTextLabel")){this.getView().byId("header::headerEditable::StickyNote::PlainTextLabel").setVisible(true);}}if(k&&!k.UICT_SegmentAuthorization){if(this.getView().byId("ActionCreateResubmissionForInvoice")){this.getView().byId("ActionCreateResubmissionForInvoice").setVisible(false);}if(this.getView().byId("ActionCompleteResubmission")){this.getView().byId("ActionCompleteResubmission").setVisible(false);}if(this.getView().byId("ActionCreateResubmission")){this.getView().byId("ActionCreateResubmission").setVisible(false);}if(this.getView().byId("ActionSetAsDefaultContact")){this.getView().byId("ActionSetAsDefaultContact").setVisible(false);}}else if(k&&k.UICT_SegmentAuthorization){if(this.getView().byId("ActionCreateResubmissionForInvoice")){this.getView().byId("ActionCreateResubmissionForInvoice").setVisible(true);}if(this.getView().byId("ActionCompleteResubmission")){this.getView().byId("ActionCompleteResubmission").setVisible(true);}if(this.getView().byId("ActionCreateResubmission")){this.getView().byId("ActionCreateResubmission").setVisible(true);}if(this.getView().byId("ActionSetAsDefaultContact")){this.getView().byId("ActionSetAsDefaultContact").setVisible(true);}}this._initPageElementStatus();if(this._bAlreadySetFilter){return;}var l=this.getView().getModel();this._bAlreadySetFilter=true;j.getCompaniesForSegmentPromise(l,{}).then(function(r){this._companies=[];for(var i=0;i<r.results.length;i++){this._companies.push({"Company":r.results[i].CompanyCode,"Segment":r.results[i].CollectionSegment});}}.bind(this));},onAfterRendering:function(){var _=this.getView().getModel().getBindings();var e=this.getView().byId("action::ActionChangeStickyNote");var i=this.getView().byId("action::ActionFinishCustomerContact");var k=_.filter(function(m){return m.sPath==="to_CollsAccountStickyNote";});if(k){k[0].attachChange(function(){var m=this.getView().getBindingContext();var o;if(m){o=m.getProperty("to_CollsAccountStickyNote");}if(o&&o.NoteText===""&&e){e.setText(this.getView().getModel("i18n").getProperty("ActionCreateStickyNote"));}else if(e){e.setText(this.getView().getModel("i18n").getProperty("ActionChangeStickyNote"));}}.bind(this));}sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported(s).done(function(r){if(!r[4].supported&&!r[5].supported){i.setVisible(false);}});var l=this.getView().byId("fin.ar.process.receivables::sap.suite.ui.generic.template.ObjectPage.view.Details::CollectionsAccount--header::headerEditable::GeneralData::BusinessPartner::Field").getSemanticObjectController();},_refreshTableContent:function(e,u){var _=this.getView().byId(e);_.getBinding("items").refresh(true);},_setActionButton:function(i,e){var o=this.getView().byId(i);o.setEnabled(e);},_byDialogId:function(e,i){return sap.ui.core.Fragment.byId(this.getView().getId()+"--"+e,i);},onLeaveAppExtension:function(i){if(!i){var e=this;return function(){var p=e.getView().getBindingContext().getPath();e.getView().getModel().read(p,{success:function(){e._initPageElementStatus();}});var k=e.getView().byId("CollectionsInvoice::responsiveTable").getBinding("items"),l=e.getView().byId("DisputeCasesCollectionSegment::responsiveTable").getBinding("items"),m=e.getView().byId("PromiseToPayCollectionSegment::responsiveTable").getBinding("items"),R=e.getView().byId("CollectionsResubmission::responsiveTable").getBinding("items"),o=e.getView().byId("CollectionsContacts::responsiveTable").getBinding("items"),H=e.getView().byId("CollectionsHeadOfficeBranch::responsiveTable").getBinding("items"),A=e.getView().byId("CollectionAccountNotes--CollsAcctNoteList").getBinding("items");if(k){k.refresh(true);}if(l){l.refresh(true);}if(m){m.refresh(true);}if(R){R.refresh(true);}if(o){o.refresh(true);}if(H){H.refresh(true);}if(A){A.refresh(true);}};}}});});
